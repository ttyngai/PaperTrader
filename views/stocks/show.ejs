<%- include('../partials/header') %>
<div>
  <h1><%= quote[0].longName%> (Ticker: <%= stock.ticker%>)</h1>

  <% if (portfolios.length !==0) {%>
  <form
    id="transaction"
    action="/stocks/<%= stock._id%>/transactions"
    method="POST"
  >
    <label>Shares:</label>
    <input type="number" min="0" class="search" name="shares" />
    <input
      type="number"
      name="price"
      class="search"
      value="<%=quote[0].regularMarketPrice%>"
      readonly="readonly"
    />

    <select name="portfolioId" class="search">
      <% portfolios.forEach(function(p){ %>
      <option value="<%= p._id%>"  <%- (p._id.toString()===preselectPortfolio.toString())? 'selected':''   %>  ><%=p.name%></option>
      <%}) %>
    </select>

    <button type="submit" class="buySellButtons" id="buyButton" name="button" value="buy">Buy</button>
    <button type="submit" class="buySellButtons" id="sellButton" name="button" value="sell">Sell</button>
  </form>
  <%} else {%>

  <a href="/portfolios/new">Start Trading</a>
  <%} %>
</div>
<div id="chart_div"></div>
<script
  type="text/javascript"
  src="https://www.gstatic.com/charts/loader.js"
></script>
<script type="text/javascript">
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable(<%- JSON.stringify(chartParsed)%>, true);
    var options = {
      legend: 'none',
      chartArea:{'width': '85%', 'height': '85%'},


      seriesType: 'candlesticks',
      series: {1: {type: 'line',lineDashStyle: [4, 4]}},

      colors: ['#242424', "#ddbc00" ],


      vAxis: { gridlineColor: '#393939',minorGridlines:{color:'transparent'}, textStyle: {
        color: '#FFF', fontSize:10
      }, gridlines:{count:10}},


      hAxis: { gridlineColor: 'transparent', textStyle: { color: '#FFF',fontSize:10  }, showTextEvery: 10,  },
      backgroundColor: 'transparent',
      candlestick: {
        risingColor: { stroke: '#028602', strokeWidth:1,fill: '#028602' },
        fallingColor: { stroke: '#aa0039', strokeWidth:1,fill: '#aa0039' },
      },

    };
    var chart = new google.visualization.CandlestickChart(
      document.getElementById('chart_div')
    );
    chart.draw(data, options);
  }
</script>
<%- include('../partials/footer') %>
<script>
  window.setTimeout(function () {
    window.location.reload();
  }, 30000);
</script>
