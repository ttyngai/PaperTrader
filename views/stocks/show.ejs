<!-- Show stock that you added, and show available portfolio, and how much to buy/sell. Jump to that portfolio when done -->
<%- include('../partials/header') %>
<div>
  <h1><%= quote[0].longName%> (Ticker: <%= stock.ticker%>)</h1>

  <table id="list">
    <thead>
      <tr>
        <th>% Change</th>
        <th>StockPrice</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= quote[0].regularMarketChangePercent.toFixed(2) %>%</td>
      </tr>
    </tbody>
  </table>

  <% if (portfolios.length !==0) {%>

  <form
    id="transaction"
    action="/stocks/<%= stock._id%>/transactions"
    method="POST"
  >
    <label>Shares:</label>
    <input type="number" min="0" name="shares" />
    <input
      type="number"
      name="price"
      value="<%=quote[0].regularMarketPrice%>"
      readonly="readonly"
    />
    <select name="portfolioId">
      <% portfolios.forEach(function(p){ %>
      <option value="<%= p._id%>"><%=p.name%></option>
      <%}) %>
    </select>
    <button type="submit" name="button" value="buy">Buy</button>
    <button type="submit" name="button" value="sell">Sell</button>
  </form>
  <%} else {%>

  <a href="/portfolios/new">Start Trading</a>
  <%} %>
</div>
<div id="chart_div"></div>

<script
  type="text/javascript"
  src="https://www.gstatic.com/charts/loader.js"
></script>
<script type="text/javascript">
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var data = google.visualization.arrayToDataTable(<%- JSON.stringify(chartParsed)%>, true);
    var options = {
      legend: 'none',
      colors: ['white'],
      vAxis: { gridlineColor: 'transparent', textStyle: { color: '#FFF' } },
      hAxis: { gridlineColor: 'transparent', textStyle: { color: '#FFF' }, showTextEvery: 5 },
      backgroundColor: 'transparent',
      candlestick: {
        risingColor: { stroke: '#028602', fill: '#028602' },
        fallingColor: { stroke: '#aa0039', fill: '#aa0039' },
      },
    };
    var chart = new google.visualization.CandlestickChart(
      document.getElementById('chart_div')
    );

    chart.draw(data, options);
  }
</script>

<%- include('../partials/footer') %>
