<%- include('../partials/header') %>
<div class="stockShowControls">
  <div>
  <h1 id="stockTitleAtShow"><%= quote[0].longName%> (<%= stock.ticker%>)</h1>

  <% if (portfolios.length !==0) {%>
      <form
        id="transaction"
        action="/stocks/<%= stock._id%>/transactions"
        method="POST"
      >
        <input type="text" min="0" class="buySellNumBox" name="shares" placeholder="Shares" autocomplete="off" autofocus />
        <input
          type="number"
          name="price"
          class="buySellNumBox"
          value="<%=quote[0].regularMarketPrice.toFixed(2)%>"
          readonly="readonly"
        />
        <select name="portfolioId" class="buySellNumBox">
          <% portfolios.forEach(function(p){ %>
          <option value="<%= p._id%>"  <%- (p._id.toString()===preselectPortfolio.toString())? 'selected':''   %>  ><%=p.name%></option>
          <%}) %>
        </select>
      </div>
      <div>
        <button type="submit" class="buySellButtons" id="buyButton" name="button" value="buy">Buy</button>
        <button type="submit" class="buySellButtons" id="sellButton" name="button" value="sell">Sell</button>
      </div>
      </form>
  
  <%} else {%>

    <h4>Create your portfolio today.</h4>
    <form action="/portfolios" method="POST">
      <input
        class="search"
        autocomplete="off"
        type="text"
        name="name"
        placeholder="e.g. Spouse, Pet"
        maxlength="16"
      />
      <input type="submit" class="formButton" value="Create" />
    </form>
  <%} %>
</div>

<div id="chart_div"></div>
<script
  type="text/javascript"
  src="https://www.gstatic.com/charts/loader.js"
></script>
<script type="text/javascript">
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable(<%- JSON.stringify(chartParsed)%>, true);
    var options = {
      legend: 'none',
      chartArea:{'width': '85%', 'height': '85%'},


      seriesType: 'candlesticks',
      series: {1: {type: 'line',lineDashStyle: [4, 4]}},

      colors: ['#242424', 'yellow' ],


      vAxis: { gridlineColor: '#393939',minorGridlines:{color:'transparent'}, textStyle: {
        color: '#FFF', fontSize:10
      }, gridlines:{count:10}},


      hAxis: { gridlineColor: 'transparent', textStyle: { color: '#FFF',fontSize:10  }, showTextEvery: 10,  },
      backgroundColor: 'transparent',
      candlestick: {
        risingColor: { stroke: '#028602', strokeWidth:1,fill: '#028602' },
        fallingColor: { stroke: '#aa0039', strokeWidth:1,fill: '#aa0039' },
      },

    };
    var chart = new google.visualization.CandlestickChart(
      document.getElementById('chart_div')
    );
    chart.draw(data, options);
  }
</script>
<%- include('../partials/footer') %>
<script>
  window.setTimeout(function () {
    window.location.reload();
  }, 30000);
</script>
